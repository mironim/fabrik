FabRecordSet=new Class({initialize:function(c,a){this.form=c;this.options={};Object.append(this.options,a);var d=this.form.getForm();var b=c.options.listid?c.options.listid:d.getElement("input[name=listid]").get("value");this.pkfield=d.getElement("input[name=rowid]");var e=this.form.id;this.view=this.form.options.editable===true?"form":"details";this.url=this.options.liveSite+"index.php?option=com_fabrik&format=raw&view=plugin&g=form&task=pluginAjax&plugin=paginate&method=xRecord&formid="+e+"&mode="+this.options.view+"&rowid=";this.watchButtons()},doUpdate:function(a){var c=JSON.decode(a);this.options.ids=c.ids;var b=this.view==="form"?c.data:c.html;this.form.formElements.each(function(d,e){if(e.substr(-3)!=="_ro"){var f=b[e];try{if(typeOf(f)!=="null"){this.view==="form"?d.update(f):d.update(Encoder.htmlDecode(f))}else{d.update("")}}catch(g){console.log(d,f,g)}}}.bind(this));if(this.view==="form"){this.pkfield.value=b[this.options.pkey]}this.reScan();window.fireEvent("fabrik.form.refresh",[c.post.rowid]);Fabrik.loader.stop(this.form.getBlock())},reScan:function(){if(typeof(Slimbox)!=="undefined"){Slimbox.scanPage()}if(typeof(Lightbox)!=="undefined"){Lightbox.init()}if(typeof(Mediabox)!=="undefined"){Mediabox.scanPage()}form=this.form.getForm();form.getElements("*[data-paginate]").each(function(b){var a=b.get("data-paginate");switch(a){case"first":case"prev":if(this.options.ids.index===0){b.addClass("active")}else{b.removeClass("active")}break;case"next":case"last":if(this.options.ids.index===this.options.ids.lastKey){b.addClass("active")}else{b.removeClass("active")}break}}.bind(this))},doNav:function(e){var b=e.get("data-paginate"),c=true,d;switch(b){case"first":if(this.options.ids.index===0){c=false}d=this.options.ids.first;break;case"last":if(this.options.ids.index===this.options.ids.lastKey){c=false}d=this.options.ids.last;break;case"prev":if(this.options.ids.index===0){c=false}d=this.options.ids.prev;break;case"next":if(this.options.ids.index===this.options.ids.lastKey){c=false}d=this.options.ids.next;break}if(!c){return}Fabrik.loader.start(this.form.getBlock());var a=new Request({url:this.url+d,evalScripts:true,onComplete:function(f){this.doUpdate(f)}.bind(this)}).send()},watchButtons:function(){var b,a;a=this.form.getForm();a.addEvent("click:relay(*[data-paginate])",function(d,c){d.preventDefault();this.doNav(c)}.bind(this))}});